<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AgriConnect | Professional Farmer Suite</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <script>
        // Auth Check
        const token = localStorage.getItem('token');
        if (!token) window.location.href = 'login.html';

        // Theme Init
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        display: ['"Outfit"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                            950: '#052e16',
                        },
                        earth: {
                            50: '#fbfaf8',
                            100: '#f5f2eb',
                            200: '#e6e0d4',
                            800: '#5c5245',
                        },
                        accent: {
                            500: '#f59e0b',
                            600: '#d97706',
                        },
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 20px rgba(34, 197, 94, 0.25)',
                        'card': '0 10px 30px -5px rgba(0,0,0,0.06)',
                        'depth': '0 20px 40px -10px rgba(22, 101, 52, 0.15)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        body {
            background-color: #fbfaf8;
            /* Warm Earth Tone */
            -webkit-tap-highlight-color: transparent;
        }

        .glass {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
        }

        .glass-dark {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            position: relative;
            overflow: hidden;
        }

        .nav-active {
            background-color: #15803d;
            color: white;
            box-shadow: 0 4px 12px rgba(21, 128, 61, 0.25);
        }

        /* Smooth Fade In */
        .view-section {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Toast Animation */
        #toast {
            visibility: hidden;
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .custom-pattern {
            background-image: radial-gradient(#166534 0.5px, transparent 0.5px), radial-gradient(#166534 0.5px, #fbfaf8 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.03;
        }
    </style>
</head>

<body
    class="text-slate-800 dark:text-slate-200 antialiased pb-28 md:pb-12 relative bg-[#fbfaf8] dark:bg-slate-950 transition-colors duration-300">

    <!-- Background Texture -->
    <div class="fixed inset-0 custom-pattern pointer-events-none z-[-1] opacity-[0.03] dark:opacity-[0.05] dark:invert">
    </div>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed bottom-24 md:bottom-10 left-1/2 z-[100] flex items-center gap-3 bg-slate-900/95 dark:bg-slate-800/95 backdrop-blur text-white px-6 py-4 rounded-2xl shadow-depth min-w-[300px] border border-white/10">
        <div class="w-8 h-8 bg-brand-500 rounded-full flex items-center justify-center text-slate-900 shrink-0">
            <i class="fa-solid fa-check"></i>
        </div>
        <div>
            <h4 class="font-bold text-sm tracking-wide text-white" id="toast-title">Success</h4>
            <p class="text-xs text-slate-400 font-medium" id="toast-msg">Action completed successfully.</p>
        </div>
    </div>

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass dark:glass-dark transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-20 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center gap-3 cursor-pointer group" onclick="switchTab('dashboard')">
                <div
                    class="w-11 h-11 bg-gradient-to-br from-brand-700 to-brand-900 rounded-xl flex items-center justify-center text-white shadow-lg shadow-brand-900/20 group-hover:scale-105 transition-transform duration-300">
                    <i class="fa-solid fa-wheat-awn text-xl"></i>
                </div>
                <div>
                    <h1
                        class="font-display font-bold text-xl leading-none text-slate-900 dark:text-white tracking-tight">
                        AgriConnect
                    </h1>
                    <span
                        class="text-[10px] font-bold text-brand-700 dark:text-brand-400 uppercase tracking-[0.2em]">Farmer
                        Suite</span>
                </div>
            </div>

            <!-- Desktop Nav -->
            <nav
                class="hidden md:flex bg-earth-100/50 dark:bg-slate-800/50 p-1.5 rounded-2xl border border-earth-200/60 dark:border-slate-700 backdrop-blur-sm">
                <button onclick="switchTab('dashboard')" id="nav-dashboard"
                    class="nav-item px-6 py-2.5 rounded-xl text-sm font-bold text-slate-600 dark:text-slate-400 transition-all hover:bg-white dark:hover:bg-slate-700 hover:text-brand-800 dark:hover:text-white nav-active">
                    <i class="fa-solid fa-grid-2 mr-2 opacity-70"></i>Dashboard
                </button>
                <button onclick="switchTab('marketplace')" id="nav-marketplace"
                    class="nav-item px-6 py-2.5 rounded-xl text-sm font-bold text-slate-600 dark:text-slate-400 transition-all hover:bg-white dark:hover:bg-slate-700 hover:text-brand-800 dark:hover:text-white">
                    <i class="fa-solid fa-shop mr-2 opacity-70"></i>Market
                </button>
                <button onclick="switchTab('analytics')" id="nav-analytics"
                    class="nav-item px-6 py-2.5 rounded-xl text-sm font-bold text-slate-600 dark:text-slate-400 transition-all hover:bg-white dark:hover:bg-slate-700 hover:text-brand-800 dark:hover:text-white">
                    <i class="fa-solid fa-chart-pie mr-2 opacity-70"></i>Insights
                </button>
                <button onclick="switchTab('profile')" id="nav-profile"
                    class="nav-item px-6 py-2.5 rounded-xl text-sm font-bold text-slate-600 dark:text-slate-400 transition-all hover:bg-white dark:hover:bg-slate-700 hover:text-brand-800 dark:hover:text-white">
                    <i class="fa-solid fa-user-circle mr-2 opacity-70"></i>Farm Profile
                </button>
            </nav>

            <!-- User Actions -->
            <div class="flex items-center gap-4">
                <div class="hidden lg:flex flex-col items-end mr-2">
                    <span class="text-xs font-bold text-slate-900 dark:text-white">Pune, IN</span>
                    <span
                        class="text-[10px] font-bold text-brand-600 dark:text-brand-400 bg-brand-50 dark:bg-brand-900/50 px-1.5 rounded flex items-center gap-1"><i
                            class="fa-solid fa-cloud-sun"></i> 28¬∞C</span>
                </div>

                <button onclick="logout()"
                    class="w-11 h-11 rounded-xl bg-white dark:bg-slate-800 text-rose-500 dark:text-rose-400 border border-slate-200 dark:border-slate-700 flex items-center justify-center shadow-sm hover:bg-rose-50 dark:hover:bg-rose-900/20 transition-colors"
                    title="Logout">
                    <i class="fa-solid fa-power-off"></i>
                </button>

                <button onclick="toggleTheme()"
                    class="w-11 h-11 rounded-xl bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700 flex items-center justify-center shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"
                    title="Toggle Theme">
                    <i class="fa-solid fa-moon dark:hidden"></i>
                    <i class="fa-solid fa-sun hidden dark:block text-yellow-500"></i>
                </button>

                <div onclick="switchTab('profile')"
                    class="w-11 h-11 rounded-xl bg-gradient-to-tr from-brand-100 to-earth-100 border-2 border-white dark:border-slate-700 p-0.5 cursor-pointer shadow-md hover:shadow-lg transition-all group">
                    <img id="header-avatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=FarmerRajesh"
                        class="w-full h-full rounded-[9px] group-hover:scale-95 transition-transform" alt="Profile">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 pt-28">

        <!-- ================= DASHBOARD VIEW ================= -->
        <section id="dashboard" class="view-section active space-y-8">

            <!-- Hero Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

                <!-- Welcome Card -->
                <div
                    class="lg:col-span-8 bg-gradient-to-br from-brand-900 to-brand-800 rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-depth group">
                    <!-- Abstract Overlay -->
                    <div
                        class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10">
                    </div>
                    <div
                        class="absolute top-0 right-0 w-[400px] h-[400px] bg-brand-500 rounded-full mix-blend-overlay filter blur-[100px] opacity-20 group-hover:opacity-30 transition-opacity duration-700">
                    </div>
                    <div
                        class="absolute bottom-0 left-0 w-[300px] h-[300px] bg-accent-600 rounded-full mix-blend-overlay filter blur-[80px] opacity-10">
                    </div>

                    <div class="relative z-10 h-full flex flex-col justify-between min-h-[280px]">
                        <div class="flex justify-between items-start">
                            <div>
                                <div
                                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 backdrop-blur-md text-xs font-bold text-brand-100 mb-4 shadow-sm">
                                    <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                                    <span>Mandi Live</span>
                                </div>
                                <h2 class="font-display font-bold text-3xl md:text-5xl mb-3 tracking-tight">Good
                                    Afternoon, <br><span class="text-brand-300 user-name-display">Farmer</span>!</h2>
                                <p class="text-brand-100/90 max-w-md text-sm md:text-base leading-relaxed">
                                    The market for <span class="font-bold text-white">Hybrid Tomatoes</span> is trending
                                    up by 12% today. Perfect time to list your stock.
                                </p>
                            </div>
                            <!-- Weather Mini Widget -->
                            <div
                                class="hidden md:block bg-white/10 backdrop-blur-md border border-white/10 p-4 rounded-2xl text-center min-w-[100px]">
                                <i class="fa-solid fa-sun text-3xl text-yellow-400 mb-2 drop-shadow-lg"></i>
                                <div class="text-2xl font-bold font-display">28¬∞</div>
                                <div class="text-[10px] uppercase font-bold text-brand-200 tracking-wider">Sunny</div>
                            </div>
                        </div>

                        <div class="mt-8 flex flex-wrap gap-4">
                            <button onclick="openModal()"
                                class="bg-white text-brand-900 px-7 py-3.5 rounded-2xl font-bold text-sm shadow-xl shadow-black/10 hover:scale-[1.02] hover:shadow-2xl transition-all flex items-center gap-2 group-btn">
                                <span
                                    class="w-6 h-6 rounded-full bg-brand-100 flex items-center justify-center text-brand-700 group-hover:bg-brand-600 group-hover:text-white transition-colors"><i
                                        class="fa-solid fa-plus text-xs"></i></span>
                                Create Listing
                            </button>
                            <button onclick="switchTab('marketplace')"
                                class="bg-brand-950/30 hover:bg-brand-950/50 border border-white/20 text-white px-7 py-3.5 rounded-2xl font-bold text-sm backdrop-blur-md transition-all">
                                View Orders (4)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Stats & Tasks -->
                <div class="lg:col-span-4 flex flex-col gap-6">
                    <!-- Revenue Card -->
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-earth-100 dark:border-slate-800 shadow-card flex-1 flex flex-col justify-center hover:translate-y-[-4px] transition-transform duration-300 relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-32 h-32 bg-green-50 rounded-full -mr-10 -mt-10 blur-2xl opacity-50">
                        </div>
                        <div class="flex items-center justify-between mb-4 relative z-10">
                            <div
                                class="w-12 h-12 bg-earth-50 rounded-2xl flex items-center justify-center text-brand-700 text-xl shadow-sm border border-earth-100">
                                <i class="fa-solid fa-wallet"></i>
                            </div>
                            <span
                                class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 border border-green-200">
                                <i class="fa-solid fa-arrow-trend-up"></i> +18%
                            </span>
                        </div>
                        <p
                            class="text-slate-500 dark:text-slate-400 text-xs font-extrabold uppercase tracking-widest mb-1">
                            Total Revenue
                        </p>
                        <h3 class="text-4xl font-display font-bold text-slate-900 dark:text-white tracking-tight">
                            ‚Çπ48,200</h3>
                    </div>

                    <!-- Daily Tasks (New Feature) -->
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-earth-100 dark:border-slate-800 shadow-card flex-1 flex flex-col relative z-0">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-bold text-slate-900 dark:text-white text-sm">Farm Tasks</h4>
                            <button
                                class="text-[10px] font-bold bg-brand-50 dark:bg-brand-900/30 text-brand-700 dark:text-brand-400 px-2 py-1 rounded-lg hover:bg-brand-100 dark:hover:bg-brand-900/50 transition-colors">Add
                                New</button>
                        </div>
                        <div class="space-y-3">
                            <label
                                class="flex items-center gap-3 p-2 hover:bg-earth-50 dark:hover:bg-slate-800 rounded-xl cursor-pointer transition-colors group">
                                <input type="checkbox"
                                    class="w-5 h-5 rounded-md border-slate-300 dark:border-slate-600 dark:bg-slate-700 text-brand-600 focus:ring-brand-500 rounded border-2">
                                <span
                                    class="text-xs font-bold text-slate-700 dark:text-slate-300 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">Fertilize
                                    Tomato Field</span>
                            </label>
                            <label
                                class="flex items-center gap-3 p-2 hover:bg-earth-50 dark:hover:bg-slate-800 rounded-xl cursor-pointer transition-colors group">
                                <input type="checkbox"
                                    class="w-5 h-5 rounded-md border-slate-300 dark:border-slate-600 dark:bg-slate-700 text-brand-600 focus:ring-brand-500 rounded border-2">
                                <span
                                    class="text-xs font-bold text-slate-700 dark:text-slate-300 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">Check
                                    Irrigation Pump</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REQUESTS & NEGOTIATIONS -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Buyer Requests Feed -->
                <div
                    class="lg:col-span-2 bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-earth-100 dark:border-slate-800 shadow-card">
                    <div class="flex items-center justify-between mb-8">
                        <div id="view-mode">
                            <h2 class="text-2xl font-display font-bold text-slate-900 dark:text-white"
                                id="profile-name">Rajesh Kumar</h2>
                            <p
                                class="text-slate-500 dark:text-slate-400 text-sm font-medium flex items-center gap-2 mt-1">
                                <i class="fa-solid fa-location-dot text-brand-500 dark:text-brand-400"></i> <span
                                    id="profile-location">Pune,
                                    MH (5 Acres)</span>
                            </p>
                        </div>
                        <span class="flex h-3 w-3 relative">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-brand-500"></span>
                    </div>
                    <div class="space-y-4" id="requests-container">
                        <!-- Request Item 1 -->
                        <div class="request-item flex flex-col sm:flex-row sm:items-center gap-5 p-5 rounded-[1.5rem] bg-earth-50 dark:bg-slate-800/50 border border-earth-100 dark:border-slate-700 transition-all hover:bg-white dark:hover:bg-slate-800 hover:shadow-lg hover:border-brand-200 dark:hover:border-brand-700 group"
                            id="req-1">
                            <div
                                class="w-14 h-14 bg-white dark:bg-slate-700 rounded-2xl flex items-center justify-center border border-earth-100 dark:border-slate-600 text-2xl shadow-sm shrink-0 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-basket-shopping text-brand-600 dark:text-brand-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="font-bold text-slate-900 dark:text-slate-200 text-base">Reliance Fresh
                                        <i class="fa-solid fa-circle-check text-blue-500 ml-1 text-xs"></i></span>
                                    <span
                                        class="text-[10px] font-bold text-slate-400 bg-white dark:bg-slate-700 px-2 py-1 rounded-full border border-earth-200 dark:border-slate-600">20m
                                        ago</span>
                                </div>
                                <p class="text-sm text-slate-600 dark:text-slate-400 leading-snug">Requires <span
                                        class="font-bold text-slate-900 dark:text-white">2 Tons Tomatoes (Hybrid)</span>
                                    delivered to
                                    Pune Warehouse.</p>
                            </div>
                            <div class="flex sm:flex-col gap-2 shrink-0">
                                <button onclick="handleRequest('req-1', 'accepted')"
                                    class="px-5 py-2.5 bg-brand-600 hover:bg-brand-700 text-white text-xs font-bold rounded-xl transition-all shadow-lg shadow-brand-600/20 active:scale-95">Accept</button>
                                <button onclick="handleRequest('req-1', 'declined')"
                                    class="px-5 py-2.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-300 hover:text-red-500 hover:border-red-200 dark:hover:border-red-500/50 text-xs font-bold rounded-xl transition-all active:scale-95">Decline</button>
                            </div>
                        </div>

                        <!-- Request Item 2 -->
                        <div class="request-item flex flex-col sm:flex-row sm:items-center gap-5 p-5 rounded-[1.5rem] bg-earth-50 dark:bg-slate-800/50 border border-earth-100 dark:border-slate-700 transition-all hover:bg-white dark:hover:bg-slate-800 hover:shadow-lg hover:border-brand-200 dark:hover:border-brand-700 group"
                            id="req-2">
                            <div
                                class="w-14 h-14 bg-white dark:bg-slate-700 rounded-2xl flex items-center justify-center border border-earth-100 dark:border-slate-600 text-2xl shadow-sm shrink-0 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-utensils text-orange-500"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="font-bold text-slate-900 dark:text-slate-200 text-base">Grand Maratha
                                        Hotel</span>
                                    <span
                                        class="text-[10px] font-bold text-slate-400 bg-white dark:bg-slate-700 px-2 py-1 rounded-full border border-earth-200 dark:border-slate-600">1h
                                        ago</span>
                                </div>
                                <p class="text-sm text-slate-600 dark:text-slate-400 leading-snug">Requires <span
                                        class="font-bold text-slate-900 dark:text-white">500 Kg Red Onions</span>
                                    delivered to
                                    Shivajinagar.</p>
                            </div>
                            <div class="flex sm:flex-col gap-2 shrink-0">
                                <button onclick="handleRequest('req-2', 'accepted')"
                                    class="px-5 py-2.5 bg-brand-600 hover:bg-brand-700 text-white text-xs font-bold rounded-xl transition-all shadow-lg shadow-brand-600/20 active:scale-95">Accept</button>
                                <button onclick="handleRequest('req-2', 'declined')"
                                    class="px-5 py-2.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-300 hover:text-red-500 hover:border-red-200 dark:hover:border-red-500/50 text-xs font-bold rounded-xl transition-all active:scale-95">Decline</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Negotiations -->
                <div
                    class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-earth-100 dark:border-slate-800 shadow-card flex flex-col">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="font-display font-bold text-slate-900 dark:text-white text-xl">Negotiations</h3>
                        <span
                            class="text-xs font-bold text-brand-700 dark:text-brand-400 bg-brand-50 dark:bg-brand-900/50 px-3 py-1.5 rounded-xl border border-brand-100 dark:border-brand-900">2
                            Active</span>
                    </div>
                    <div class="space-y-4 flex-1 overflow-y-auto max-h-[400px] pr-1 custom-scrollbar">
                        <div
                            class="p-4 rounded-2xl bg-earth-50 dark:bg-slate-800/50 border border-transparent hover:border-brand-200 dark:hover:border-brand-700 transition-all cursor-pointer group hover:bg-white dark:hover:bg-slate-800 hover:shadow-md">
                            <div class="flex justify-between items-start mb-2">
                                <p class="text-sm font-bold text-slate-800 dark:text-slate-200">Deal #4029 - Wheat</p>
                                <span
                                    class="text-[10px] font-bold text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400 px-2 py-1 rounded-lg border border-amber-100 dark:border-amber-900/50">Counter
                                    Offer</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500 mb-3">
                                <span>Bid: ‚Çπ2,400</span>
                                <span>Ask: ‚Çπ2,600</span>
                            </div>
                            <div class="w-full bg-slate-200 h-2 rounded-full overflow-hidden">
                                <div
                                    class="bg-amber-500 h-full rounded-full group-hover:w-[70%] transition-all duration-1000 w-[60%]">
                                </div>
                            </div>
                        </div>

                        <div
                            class="p-4 rounded-2xl bg-earth-50 dark:bg-slate-800/50 border border-transparent hover:border-brand-200 dark:hover:border-brand-700 transition-all cursor-pointer group hover:bg-white dark:hover:bg-slate-800 hover:shadow-md">
                            <div class="flex justify-between items-start mb-2">
                                <p class="text-sm font-bold text-slate-800 dark:text-slate-200">Deal #4035 - Corn</p>
                                <span
                                    class="text-[10px] font-bold text-blue-600 bg-blue-50 dark:bg-blue-900/30 dark:text-blue-400 px-2 py-1 rounded-lg border border-blue-100 dark:border-blue-900/50">Waiting</span>
                            </div>
                            <p class="text-xs text-slate-500 mb-3">Proposal sent to buyer.</p>
                            <div class="w-full bg-slate-200 h-2 rounded-full overflow-hidden">
                                <div class="bg-blue-500 h-full rounded-full w-[30%]"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <button
                    class="w-full mt-6 py-4 text-xs font-bold text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-earth-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center gap-2 uppercase tracking-wide">
                    View History
                </button>
            </div>
            </div>

            <!-- Market Ticker -->
            <div class="pt-4">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-xl font-display font-bold text-slate-900 dark:text-white">Mandi Market Prices
                        </h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Real-time updates from Pune APMC</p>
                    </div>
                    <a href="#" onclick="switchTab('analytics')"
                        class="text-xs font-bold text-white bg-slate-900 px-4 py-2 rounded-full hover:bg-slate-800 flex items-center gap-2 transition-colors">Full
                        Report <i class="fa-solid fa-arrow-right"></i></a>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="price-ticker">
                    <!-- JS Injected Cards -->
                </div>
            </div>
        </section>

        <!-- ================= MARKETPLACE VIEW ================= -->
        <section id="marketplace" class="view-section space-y-8">
            <!-- Search Header -->
            <div
                class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-card border border-earth-100 dark:border-slate-800 sticky top-24 z-30 transition-all">
                <div class="flex flex-col md:flex-row gap-5">
                    <div class="relative flex-1 group">
                        <i
                            class="fa-solid fa-magnifying-glass absolute left-5 top-4 text-slate-400 group-focus-within:text-brand-600 dark:group-focus-within:text-brand-400 transition-colors"></i>
                        <input type="text" id="market-search" placeholder="Search crops, buyers, or locations..."
                            class="w-full bg-earth-50 dark:bg-slate-800 border-2 border-transparent hover:border-earth-200 dark:hover:border-slate-700 focus:border-brand-500 rounded-2xl py-3.5 pl-12 pr-4 text-sm font-semibold text-slate-800 dark:text-white outline-none transition-all placeholder:text-slate-400"
                            onkeyup="filterMarketplace()">
                    </div>
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1 md:pb-0">
                        <button onclick="filterCategory('all')"
                            class="market-filter active px-6 py-3.5 bg-brand-900 dark:bg-brand-700 text-white rounded-2xl text-xs font-bold whitespace-nowrap shadow-lg shadow-brand-900/20 transition-all hover:bg-brand-800">All
                            Stock</button>
                        <button onclick="filterCategory('vegetable')"
                            class="market-filter px-6 py-3.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400 rounded-2xl text-xs font-bold whitespace-nowrap hover:bg-earth-50 dark:hover:bg-slate-700 hover:border-slate-300 transition-all">Vegetables</button>
                        <button onclick="filterCategory('grain')"
                            class="market-filter px-6 py-3.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400 rounded-2xl text-xs font-bold whitespace-nowrap hover:bg-earth-50 dark:hover:bg-slate-700 hover:border-slate-300 transition-all">Grains</button>
                        <button onclick="filterCategory('fruit')"
                            class="market-filter px-6 py-3.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400 rounded-2xl text-xs font-bold whitespace-nowrap hover:bg-earth-50 dark:hover:bg-slate-700 hover:border-slate-300 transition-all">Fruits</button>
                    </div>
                </div>
            </div>

            <!-- Listings Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="marketplace-grid">
                <!-- JS Injected -->
            </div>

            <!-- Empty State -->
            <div id="no-results" class="hidden flex flex-col items-center justify-center py-20">
                <div
                    class="w-24 h-24 bg-earth-100 dark:bg-slate-800 rounded-full flex items-center justify-center text-slate-300 dark:text-slate-600 text-4xl mb-6">
                    <i class="fa-solid fa-leaf"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-800 dark:text-white">No listings found</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">Try adjusting your filters or search terms.
                </p>
            </div>
        </section>

        <!-- ================= ANALYTICS VIEW ================= -->
        <section id="analytics" class="view-section space-y-8">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white">Market Intelligence</h2>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-medium mt-1">Data-driven insights for
                        better pricing.</p>
                </div>
                <button
                    class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 px-5 py-2.5 rounded-xl text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-download"></i> Download Report
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Demand Analysis Card -->
                <div
                    class="lg:col-span-2 bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-earth-100 dark:border-slate-800 shadow-card">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h3 class="font-bold text-slate-900 dark:text-white text-lg">Regional Demand</h3>
                            <p class="text-xs text-slate-400">Buyer search volume (Last 24h)</p>
                        </div>
                        <span
                            class="text-[10px] font-bold bg-brand-50 dark:bg-brand-900/30 text-brand-700 dark:text-brand-400 px-3 py-1 rounded-full border border-brand-100 dark:border-brand-900/50 flex items-center gap-1">
                            <span class="w-1.5 h-1.5 rounded-full bg-brand-500 animate-pulse"></span> Live
                        </span>
                    </div>
                    <div class="space-y-6">
                        <div class="group">
                            <div class="flex justify-between text-xs font-bold mb-2">
                                <span class="text-slate-600 dark:text-slate-400">Mumbai</span>
                                <span class="text-slate-900 dark:text-white">Very High</span>
                            </div>
                            <div class="h-4 bg-earth-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                <div
                                    class="h-full bg-gradient-to-r from-brand-400 to-brand-600 rounded-full w-[85%] group-hover:scale-x-105 transition-transform origin-left">
                                </div>
                            </div>
                        </div>
                        <div class="group">
                            <div class="flex justify-between text-xs font-bold mb-2">
                                <span class="text-slate-600 dark:text-slate-400">Pune</span>
                                <span class="text-slate-900 dark:text-white">High</span>
                            </div>
                            <div class="h-4 bg-earth-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                <div
                                    class="h-full bg-gradient-to-r from-brand-300 to-brand-500 rounded-full w-[65%] group-hover:scale-x-105 transition-transform origin-left">
                                </div>
                            </div>
                        </div>
                        <div class="group">
                            <div class="flex justify-between text-xs font-bold mb-2">
                                <span class="text-slate-600 dark:text-slate-400">Nashik</span>
                                <span class="text-slate-900 dark:text-white">Moderate</span>
                            </div>
                            <div class="h-4 bg-earth-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                <div
                                    class="h-full bg-gradient-to-r from-brand-200 to-brand-400 rounded-full w-[40%] group-hover:scale-x-105 transition-transform origin-left">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logistics/Weather Card -->
                <div
                    class="bg-gradient-to-b from-slate-800 to-slate-900 p-8 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden group">
                    <div
                        class="absolute -right-10 -top-10 w-40 h-40 bg-blue-500 rounded-full blur-[80px] opacity-20 group-hover:opacity-30 transition-opacity">
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-8">
                        <div
                            class="bg-earth-50 dark:bg-slate-800 rounded-2xl p-4 border border-earth-100 dark:border-slate-700">
                            <p
                                class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase tracking-wider mb-1">
                                Crops Listed</p>
                            <h4 class="text-2xl font-display font-bold text-slate-900 dark:text-white">12</h4>
                        </div>
                        <div
                            class="bg-earth-50 dark:bg-slate-800 rounded-2xl p-4 border border-earth-100 dark:border-slate-700">
                            <p
                                class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase tracking-wider mb-1">
                                Deals Closed
                            </p>
                            <h4 class="text-2xl font-display font-bold text-slate-900 dark:text-white">45</h4>
                        </div>
                    </div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="font-bold text-slate-100 text-lg">Logistics</h3>
                            <i class="fa-solid fa-truck-fast text-slate-400"></i>
                        </div>
                        <div class="space-y-5">
                            <div
                                class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5">
                                <span class="text-xs font-bold text-slate-300">Highways</span>
                                <span
                                    class="text-[10px] font-bold bg-green-500/20 text-green-300 px-2 py-1 rounded">Clear</span>
                            </div>
                            <div
                                class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5">
                                <span class="text-xs font-bold text-slate-300">Weather</span>
                                <div class="flex items-center gap-2">
                                    <i class="fa-solid fa-cloud-sun text-yellow-400"></i>
                                    <span class="text-[10px] text-slate-200">Good Visibility</span>
                                </div>
                            </div>
                            <div class="mt-6">
                                <p class="text-[10px] text-slate-400 uppercase tracking-widest font-bold mb-2">
                                    Recommendation</p>
                                <p class="text-xs text-white leading-relaxed font-medium">Dispatch Pune shipments
                                    tomorrow at <span class="text-brand-300">05:00 AM</span> to avoid congestion at toll
                                    plaza.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= PROFILE VIEW ================= -->
        <section id="profile" class="view-section space-y-8 pb-12">
            <!-- Profile Header -->
            <div class="relative bg-white rounded-[2.5rem] shadow-card overflow-hidden border border-earth-100">
                <!-- Cover Image -->
                <div class="h-48 bg-slate-800 relative overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&q=80&w=1200"
                        class="w-full h-full object-cover opacity-60">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                    <!-- Profile Card -->
                    <div
                        class="lg:col-span-2 bg-white dark:bg-slate-900 rounded-[2.5rem] shadow-card overflow-hidden border border-earth-100 dark:border-slate-800 relative group">
                        <div class="h-32 bg-gradient-to-r from-brand-600 to-brand-800 relative overflow-hidden">
                            <div
                                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10">
                            </div>
                        </div>
                        <div class="px-8 pb-8">
                            <div class="relative flex justify-between items-end -mt-12 mb-6">
                                <div
                                    class="w-24 h-24 rounded-2xl bg-white dark:bg-slate-900 p-1 shadow-lg rotate-3 group-hover:rotate-0 transition-transform duration-300">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=FarmerRajesh"
                                        class="w-full h-full rounded-[10px] bg-earth-100 dark:bg-slate-800"
                                        alt="Profile">
                                </div>
                                <button onclick="toggleEditProfile()"
                                    class="bg-brand-50 dark:bg-brand-900/30 text-brand-700 dark:text-brand-400 px-4 py-2 rounded-xl text-xs font-bold hover:bg-brand-100 dark:hover:bg-brand-900/50 transition-colors flex items-center gap-2">
                                    <i class="fa-solid fa-pen"></i> Edit Profile
                                </button>
                            </div>
                            <div class="flex-1 text-center md:text-left mb-2">
                                <h2 class="text-3xl font-display font-bold text-slate-900 user-name-display mb-1">Rajesh
                                    Kumar</h2>
                                <p
                                    class="absolute top-4 right-4 bg-black/30 backdrop-blur text-white text-xs font-bold px-3 py-1.5 rounded-lg hover:bg-black/50 transition-colors border border-white/20">
                                    <i class="fa-solid fa-camera mr-1"></i> Edit Cover
                                    </button>
                            </div>

                            <div class="px-8 pb-8 relative">
                                <div class="flex flex-col md:flex-row items-center md:items-end -mt-16 mb-6 gap-6">
                                    <div class="w-32 h-32 rounded-[2rem] bg-white p-1.5 shadow-xl relative group z-10">
                                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=FarmerRajesh"
                                            class="w-full h-full rounded-[1.5rem] bg-slate-50 object-cover"
                                            alt="Profile">
                                        <div
                                            class="absolute bottom-1 right-1 w-8 h-8 bg-brand-500 rounded-full border-4 border-white flex items-center justify-center text-white text-xs shadow-sm">
                                            <i class="fa-solid fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1 text-center md:text-left mb-2">
                                        <h2
                                            class="text-3xl font-display font-bold text-slate-900 user-name-display mb-1">
                                            Rajesh
                                            Kumar</h2>
                                        <p
                                            class="text-sm text-slate-500 font-bold user-farm-display flex items-center justify-center md:justify-start gap-2">
                                            <i class="fa-solid fa-tractor text-brand-500"></i> Green Valley Farms ‚Ä¢
                                            Pune, MH
                                        </p>
                                    </div>
                                    <button onclick="toggleEditProfile()"
                                        class="px-6 py-3 bg-slate-900 text-white rounded-xl text-xs font-bold transition-all hover:bg-slate-800 shadow-lg shadow-slate-900/20">
                                        Edit Profile
                                    </button>
                                </div>

                                <!-- My Crops Tags (New) -->
                                <div class="flex flex-wrap gap-2 mb-6 justify-center md:justify-start">
                                    <span
                                        class="px-3 py-1 bg-earth-100 text-slate-600 rounded-lg text-xs font-bold border border-earth-200">üçÖ
                                        Tomatoes</span>
                                    <span
                                        class="px-3 py-1 bg-earth-100 text-slate-600 rounded-lg text-xs font-bold border border-earth-200">üåæ
                                        Wheat</span>
                                    <span
                                        class="px-3 py-1 bg-earth-100 text-slate-600 rounded-lg text-xs font-bold border border-earth-200">üßÖ
                                        Onions</span>
                                    <button
                                        class="px-3 py-1 border border-dashed border-slate-300 text-slate-400 rounded-lg text-xs font-bold hover:border-brand-500 hover:text-brand-600 transition-colors">+
                                        Add Crop</button>
                                </div>

                                <!-- Edit Form -->
                                <div id="edit-profile-form"
                                    class="hidden mt-6 mb-6 p-6 bg-earth-50 rounded-2xl border border-earth-100">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                        <div>
                                            <label
                                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Full
                                                Name</label>
                                            <input type="text" id="edit-name"
                                                class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all">
                                        </div>
                                        <div>
                                            <label
                                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Farm
                                                Name</label>
                                            <input type="text" id="edit-farm"
                                                class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all">
                                        </div>
                                        <div>
                                            <label
                                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Location</label>
                                            <input type="text" id="edit-location"
                                                class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all">
                                            <div id="edit-mode" class="hidden space-y-4 max-w-md">
                                                <input type="text" id="edit-name" value="Rajesh Kumar"
                                                    class="w-full bg-earth-50 dark:bg-slate-800 border-2 border-transparent focus:border-brand-500 rounded-xl px-4 py-2 text-sm font-bold text-slate-900 dark:text-white outline-none">
                                                <input type="text" id="edit-location" value="Pune, MH"
                                                    class="w-full bg-earth-50 dark:bg-slate-800 border-2 border-transparent focus:border-brand-500 rounded-xl px-4 py-2 text-sm font-bold text-slate-900 dark:text-white outline-none">
                                                <input type="text" id="edit-farm" value="5 Acres"
                                                    class="w-full bg-earth-50 dark:bg-slate-800 border-2 border-transparent focus:border-brand-500 rounded-xl px-4 py-2 text-sm font-bold text-slate-900 dark:text-white outline-none">
                                                <input type="text" id="edit-phone" value="+91 98765 43210"
                                                    class="w-full bg-earth-50 dark:bg-slate-800 border-2 border-transparent focus:border-brand-500 rounded-xl px-4 py-2 text-sm font-bold text-slate-900 dark:text-white outline-none">
                                                <button onclick="saveProfile()"
                                                    class="bg-brand-600 text-white px-6 py-2 rounded-xl text-sm font-bold shadow-lg shadow-brand-600/20 active:scale-95 transition-transform">Save
                                                    Changes</button>
                                            </div>
                                        </div>
                                        <div>
                                            <label
                                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Phone</label>
                                            <input type="text" id="edit-phone"
                                                class="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 transition-all">
                                        </div>
                                    </div>
                                    <div class="flex justify-end gap-3 mt-6">
                                        <button onclick="toggleEditProfile()"
                                            class="px-5 py-2.5 text-xs font-bold text-slate-500 hover:text-slate-800">Cancel</button>
                                        <button onclick="saveProfile()"
                                            class="px-5 py-2.5 bg-brand-600 text-white rounded-xl text-xs font-bold shadow-lg shadow-brand-600/20 hover:bg-brand-700">Save
                                            Changes</button>
                                    </div>
                                </div>

                                <!-- Stats Row -->
                                <div class="grid grid-cols-3 gap-4 border-t border-earth-100 pt-6">
                                    <div class="text-center md:text-left">
                                        <span class="block text-2xl font-display font-bold text-slate-900"
                                            id="profile-listings-count">0</span>
                                        <span
                                            class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Active
                                            Listings</span>
                                    </div>
                                    <!-- Stats Card -->
                                    <div
                                        class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-earth-100 dark:border-slate-800 shadow-card">
                                        <h3 class="font-bold text-slate-900 dark:text-white text-lg mb-6">Verification
                                            Status</h3>
                                        <div class="text-center md:text-left border-l border-earth-100 pl-4">
                                            <span
                                                class="block text-2xl font-display font-bold text-slate-900 flex items-center justify-center md:justify-start gap-1">4.8
                                                <i class="fa-solid fa-star text-sm text-yellow-400"></i></span>
                                            <span
                                                class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Buyer
                                                Rating</span>
                                        </div>
                                        <div class="text-center md:text-left border-l border-earth-100 pl-4">
                                            <span class="block text-2xl font-display font-bold text-slate-900">3 <span
                                                    class="text-sm text-slate-400 font-normal">Yrs</span></span>
                                            <span
                                                class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Membership</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- My History -->
                            <div class="px-2">
                                <h3 class="font-display font-bold text-xl text-slate-900 mb-4">Inventory History</h3>
                                <div id="profile-history-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
        </section>

    </main>

    <!-- Mobile Navigation Bottom Bar -->
    <nav
        class="md:hidden fixed bottom-0 left-0 w-full bg-white dark:bg-slate-900 border-t border-earth-100 dark:border-slate-800 z-50 pb-safe shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
        <div class="flex justify-around items-center h-20 px-2 relative">
            <button onclick="switchTab('dashboard')"
                class="mob-nav-btn flex flex-col items-center gap-1 p-2 text-brand-700 mob-active transition-colors w-16 group"
                id="mob-dashboard">
                <div
                    class="w-8 h-8 rounded-full bg-transparent group-[.mob-active]:bg-brand-50 dark:group-[.mob-active]:bg-brand-900/30 flex items-center justify-center transition-colors mb-0.5">
                    <i class="fa-solid fa-grid-2 text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">Home</span>
            </button>
            <button onclick="switchTab('marketplace')"
                class="mob-nav-btn flex flex-col items-center gap-1 p-2 text-slate-400 transition-colors w-16 group"
                id="mob-marketplace">
                <div
                    class="w-8 h-8 rounded-full bg-transparent group-[.mob-active]:bg-brand-50 dark:group-[.mob-active]:bg-brand-900/30 flex items-center justify-center transition-colors mb-0.5">
                    <i class="fa-solid fa-shop text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">Market</span>
            </button>

            <!-- Floating FAB -->
            <div class="relative -top-6">
                <button onclick="openModal()"
                    class="w-14 h-14 bg-gradient-to-r from-brand-600 to-brand-500 rounded-full flex items-center justify-center text-white shadow-xl shadow-brand-600/40 border-[6px] border-[#fbfaf8] dark:border-slate-900 active:scale-95 transition-transform hover:scale-110">
                    <i class="fa-solid fa-plus text-xl"></i>
                </button>
            </div>

            <button onclick="switchTab('analytics')"
                class="mob-nav-btn flex flex-col items-center gap-1 p-2 text-slate-400 transition-colors w-16 group"
                id="mob-analytics">
                <div
                    class="w-8 h-8 rounded-full bg-transparent group-[.mob-active]:bg-brand-50 dark:group-[.mob-active]:bg-brand-900/30 flex items-center justify-center transition-colors mb-0.5">
                    <i class="fa-solid fa-chart-pie text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">Trends</span>
            </button>
            <button onclick="switchTab('profile')"
                class="mob-nav-btn flex flex-col items-center gap-1 p-2 text-slate-400 transition-colors w-16 group"
                id="mob-profile">
                <div
                    class="w-8 h-8 rounded-full bg-transparent group-[.mob-active]:bg-brand-50 dark:group-[.mob-active]:bg-brand-900/30 flex items-center justify-center transition-colors mb-0.5">
                    <i class="fa-solid fa-user-circle text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">Farm</span>
            </button>
        </div>
    </nav>

    <!-- Create Listing Modal -->
    <div id="listingModal" class="fixed inset-0 z-[60] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity opacity-0" id="modalBackdrop"
            onclick="closeModal()"></div>

        <!-- Modal Content -->
        <div class="absolute bottom-0 md:top-1/2 md:bottom-auto md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 w-full md:w-[500px] bg-white rounded-t-[2.5rem] md:rounded-[2.5rem] shadow-2xl transform translate-y-full md:translate-y-10 opacity-0 transition-all duration-300 flex flex-col max-h-[90vh]"
            id="modalContent">

            <div
                class="p-8 border-b border-slate-100 flex justify-between items-center bg-earth-50/50 rounded-t-[2.5rem]">
                <div>
                    <h3 class="text-xl font-display font-bold text-slate-900">New Listing</h3>
                    <p class="text-xs text-slate-500 font-medium mt-1">Connect with 500+ verified buyers</p>
                </div>
                <button onclick="closeModal()"
                    class="w-9 h-9 rounded-full bg-slate-100 text-slate-400 flex items-center justify-center hover:bg-slate-200 hover:text-slate-600 transition-colors">
                    <i class="fa-solid fa-xmark text-sm"></i>
                </button>
            </div>

            <div class="p-8 overflow-y-auto space-y-6 custom-scrollbar">
                <!-- Image Upload -->
                <div
                    class="w-full h-40 border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center text-slate-400 bg-slate-50 hover:bg-brand-50 hover:border-brand-300 hover:text-brand-600 transition-all cursor-pointer group">
                    <div
                        class="w-12 h-12 rounded-full bg-white shadow-sm flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-camera text-xl"></i>
                    </div>
                    <span class="text-xs font-bold">Add Crop Photos</span>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Item
                        Name</label>
                    <input type="text" id="itemName"
                        class="w-full bg-white border border-slate-200 rounded-2xl p-4 text-sm font-bold text-slate-800 focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"
                        placeholder="e.g. Organic Red Tomatoes">
                </div>

                <div class="grid grid-cols-2 gap-5">
                    <div>
                        <label
                            class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Category</label>
                        <div class="relative">
                            <select id="itemCat"
                                class="w-full bg-white border border-slate-200 rounded-2xl p-4 text-sm font-bold text-slate-800 focus:ring-2 focus:ring-brand-500 outline-none appearance-none">
                                <option value="vegetable">Vegetable</option>
                                <option value="grain">Grain</option>
                                <option value="fruit">Fruit</option>
                            </select>
                            <i
                                class="fa-solid fa-chevron-down absolute right-4 top-4.5 text-slate-400 pointer-events-none text-xs"></i>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Quantity
                            (Kg)</label>
                        <input type="number" id="itemQty"
                            class="w-full bg-white border border-slate-200 rounded-2xl p-4 text-sm font-bold text-slate-800 focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"
                            placeholder="0">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Price /
                        Kg</label>
                    <div class="relative">
                        <span class="absolute left-4 top-4 text-slate-400 font-bold">‚Çπ</span>
                        <input type="number" id="itemPrice"
                            class="w-full bg-white border border-slate-200 rounded-2xl p-4 pl-8 text-sm font-bold text-slate-800 focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-all"
                            placeholder="00">
                    </div>
                </div>

                <!-- Price Advice -->
                <div class="bg-amber-50 p-5 rounded-2xl border border-amber-100 flex gap-4 items-start">
                    <div
                        class="w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 shrink-0">
                        <i class="fa-solid fa-lightbulb"></i>
                    </div>
                    <div class="text-xs text-amber-900 leading-relaxed">
                        <p class="font-bold mb-1">Pricing Insight</p>
                        <p>Market average is <span class="font-bold">‚Çπ24</span>. Listing at <span
                                class="font-bold text-green-700">‚Çπ22</span> usually sells in under 4 hours.</p>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-slate-100 bg-white md:rounded-b-[2.5rem]">
                <button onclick="submitListing()"
                    class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-brand-600/20 active:scale-95 transition-all text-sm tracking-wide">
                    Publish Listing
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            user: {
                name: 'Rajesh Kumar',
                farmName: 'Green Valley Farms',
                location: 'Pune, Maharashtra',
                phone: '+91 98765 43210',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=FarmerRajesh',
                joined: '3 yrs'
            },
            marketPrices: [
                { id: 1, name: 'Wheat (Lokwan)', price: 2600, trend: 'up', change: 2.4 },
                { id: 2, name: 'Onion (Red)', price: 1850, trend: 'up', change: 5.1 },
                { id: 3, name: 'Soybean', price: 4100, trend: 'down', change: 1.2 },
                { id: 4, name: 'Tomato (Hybrid)', price: 1200, trend: 'stable', change: 0.0 },
            ],
            listings: [
                { id: 1, name: 'Fresh Organic Tomatoes', category: 'vegetable', price: 22, qty: '500 kg', farmer: 'Rajesh Kumar', loc: 'Pune, MH', time: '2h ago', img: 'https://images.unsplash.com/photo-1592924357228-91a4daadcfea?auto=format&fit=crop&q=80&w=600', verified: true, isMine: true },
                { id: 2, name: 'Premium Basmati Rice', category: 'grain', price: 65, qty: '1.2 Tons', farmer: 'Amit Singh', loc: 'Nashik, MH', time: '5h ago', img: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&q=80&w=600', verified: false, isMine: false },
                { id: 3, name: 'Yellow Corn / Maize', category: 'grain', price: 18, qty: '800 kg', farmer: 'Suresh P.', loc: 'Satara, MH', time: '1d ago', img: 'https://images.unsplash.com/photo-1551754655-cd27e38d2076?auto=format&fit=crop&q=80&w=600', verified: true, isMine: false },
                { id: 4, name: 'Nagpur Oranges', category: 'fruit', price: 40, qty: '300 kg', farmer: 'Vijay D.', loc: 'Nagpur, MH', time: '3h ago', img: 'https://images.unsplash.com/photo-1611080626919-7cf5a9dbab5a?auto=format&fit=crop&q=80&w=600', verified: true, isMine: false },
            ]
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load User Data
            const userStr = localStorage.getItem('user');
            if (userStr) {
                const user = JSON.parse(userStr);
                state.user.name = user.name;
                if (user.location) state.user.location = user.location;
                // Update avatar in header
                const headerAvatar = document.getElementById('header-avatar');
                if (headerAvatar) headerAvatar.src = `https://api.dicebear.com/7.x/initials/svg?seed=${user.name}`;
            }
            renderPrices();
            renderListings();
            updateProfileUI();
        });

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Hide all sections
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.remove('active');
            });

            // Show target
            const target = document.getElementById(tabId);
            if (target) target.classList.add('active');

            // Desktop Nav Update
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('nav-active', 'bg-slate-100');
            });
            const activeDesktop = document.getElementById(`nav-${tabId}`);
            if (activeDesktop) activeDesktop.classList.add('nav-active');

            // Mobile Nav Update
            document.querySelectorAll('.mob-nav-btn').forEach(el => {
                el.classList.remove('mob-active', 'text-brand-700');
                el.classList.add('text-slate-400');
            });
            const activeMobile = document.getElementById(`mob-${tabId}`);
            if (activeMobile) {
                activeMobile.classList.remove('text-slate-400');
                activeMobile.classList.add('mob-active', 'text-brand-700');
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Data Rendering ---
        function renderPrices() {
            const container = document.getElementById('price-ticker');
            container.innerHTML = state.marketPrices.map(item => {
                const isUp = item.trend === 'up';
                const isDown = item.trend === 'down';
                const colorClass = isUp ? 'text-green-600 bg-green-50 border-green-100' : (isDown ? 'text-red-600 bg-red-50 border-red-100' : 'text-slate-500 bg-slate-50 border-slate-100');
                const icon = isUp ? 'fa-arrow-trend-up' : (isDown ? 'fa-arrow-trend-down' : 'fa-minus');

                return `
                <div class="bg-white p-5 rounded-2xl border border-earth-100 shadow-sm hover:shadow-md transition-shadow cursor-pointer flex items-center justify-between group">
                    <div>
                        <p class="font-bold text-slate-800 text-sm group-hover:text-brand-700 transition-colors">${item.name}</p>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1">Avg / Quintal</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-slate-900 text-lg">‚Çπ${item.price}</p>
                        <span class="inline-flex items-center gap-1 text-[10px] font-bold px-2 py-0.5 rounded-full border ${colorClass}">
                            <i class="fa-solid ${icon}"></i> ${item.change}%
                        </span>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderListings(filterText = '', category = 'all') {
            const container = document.getElementById('marketplace-grid');
            const noResults = document.getElementById('no-results');

            // Filter Logic
            const filtered = state.listings.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(filterText.toLowerCase()) ||
                    item.farmer.toLowerCase().includes(filterText.toLowerCase());
                const matchesCat = category === 'all' || item.category === category;
                return matchesSearch && matchesCat;
            });

            if (filtered.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            } else {
                noResults.classList.add('hidden');
            }

            container.innerHTML = filtered.map(item => `
                <div class="bg-white rounded-[2rem] overflow-hidden border border-earth-100 shadow-card group hover:translate-y-[-5px] transition-transform duration-300 flex flex-col h-full hover:shadow-depth">
                    <div class="relative h-56 overflow-hidden">
                        <img src="${item.img}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="${item.name}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-60"></div>
                        <div class="absolute top-4 right-4 bg-white/95 backdrop-blur px-3 py-1.5 rounded-xl text-xs font-bold text-slate-900 shadow-sm border border-white/20">
                            ‚Çπ${item.price}/kg
                        </div>
                        ${item.verified ? '<div class="absolute bottom-4 left-4 bg-green-500/90 backdrop-blur text-white text-[10px] font-bold px-2.5 py-1 rounded-lg flex items-center gap-1 shadow-sm"><i class="fa-solid fa-certificate"></i> VERIFIED</div>' : ''}
                        ${item.isMine ? '<div class="absolute top-4 left-4 bg-brand-600/90 backdrop-blur text-white text-[10px] font-bold px-2.5 py-1 rounded-lg shadow-sm">MY STOCK</div>' : ''}
                    </div>
                    <div class="p-6 flex flex-col flex-1">
                        <div class="mb-4">
                            <h3 class="font-bold text-slate-900 text-lg leading-tight line-clamp-1 group-hover:text-brand-700 transition-colors">${item.name}</h3>
                            <p class="text-xs text-slate-500 mt-1 font-medium flex items-center"><i class="fa-solid fa-location-dot mr-1.5 text-brand-500"></i> ${item.loc}</p>
                        </div>
                        
                        <div class="mt-auto pt-4 border-t border-earth-100 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-earth-100 flex items-center justify-center text-xs font-bold text-slate-600 border border-earth-200 shadow-sm">
                                    ${item.farmer.charAt(0)}
                                </div>
                                <div>
                                    <p class="text-xs font-bold text-slate-800 line-clamp-1">${item.farmer}</p>
                                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">${item.time}</p>
                                </div>
                            </div>
                            <button onclick="contactFarmer('${item.name}')" class="bg-earth-50 text-slate-400 border border-earth-200 hover:bg-brand-600 hover:text-white hover:border-brand-600 transition-colors w-10 h-10 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-phone text-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            // Also update Profile History
            renderProfileHistory();
        }

        // --- Marketplace Filters ---
        function filterMarketplace() {
            const searchVal = document.getElementById('market-search').value;
            // Simplified: Reset filters to 'all' visually if searching, for this demo
            // In a real app, we'd keep track of active category state
            renderListings(searchVal, 'all');

            document.querySelectorAll('.market-filter').forEach(btn => {
                btn.classList.remove('active', 'bg-brand-900', 'text-white');
                btn.classList.add('bg-white', 'text-slate-600');
                if (btn.innerText.includes("All")) {
                    btn.classList.add('active', 'bg-brand-900', 'text-white');
                    btn.classList.remove('bg-white', 'text-slate-600');
                }
            });
        }

        function filterCategory(cat) {
            const searchVal = document.getElementById('market-search').value;
            renderListings(searchVal, cat);

            // Update Button Styles
            document.querySelectorAll('.market-filter').forEach(btn => {
                btn.classList.remove('active', 'bg-brand-900', 'text-white');
                btn.classList.add('bg-white', 'text-slate-600');
            });
            event.target.classList.add('active', 'bg-brand-900', 'text-white');
            event.target.classList.remove('bg-white', 'text-slate-600');
        }

        // --- Profile Logic ---
        function updateProfileUI() {
            document.querySelectorAll('.user-name-display').forEach(el => el.innerText = state.user.name);
            document.querySelectorAll('.user-farm-display').forEach(el => {
                // Keep the icon if it exists inside
                const icon = el.querySelector('i');
                el.innerText = ` ${state.user.farmName} ‚Ä¢ ${state.user.location}`;
                if (icon) el.prepend(icon);
            });

            // Pre-fill inputs
            document.getElementById('edit-name').value = state.user.name;
            document.getElementById('edit-farm').value = state.user.farmName;
            document.getElementById('edit-location').value = state.user.location;
            document.getElementById('edit-phone').value = state.user.phone;

            // Count Listings
            const myCount = state.listings.filter(l => l.isMine).length;
            document.getElementById('profile-listings-count').innerText = myCount;
        }

        function renderProfileHistory() {
            const myListings = state.listings.filter(l => l.isMine);
            const container = document.getElementById('profile-history-list');

            if (myListings.length === 0) {
                container.innerHTML = '<div class="col-span-2 text-center py-8 text-slate-400 italic">No inventory listed yet.</div>';
                return;
            }

            container.innerHTML = myListings.map(item => `
                <div class="flex items-center gap-4 bg-white p-4 rounded-2xl border border-earth-100 shadow-sm hover:shadow-md transition-shadow group">
                    <img src="${item.img}" class="w-16 h-16 rounded-xl object-cover" alt="thumb">
                    <div class="flex-1">
                        <h4 class="font-bold text-slate-900 text-sm">${item.name}</h4>
                        <div class="flex items-center gap-3 mt-1">
                            <span class="text-xs text-slate-500 font-medium bg-earth-50 px-2 py-0.5 rounded">${item.qty}</span>
                            <span class="text-xs text-brand-700 font-bold">‚Çπ${item.price}/kg</span>
                        </div>
                    </div>
                    <button class="w-8 h-8 rounded-lg text-slate-400 hover:text-red-500 hover:bg-red-50 transition-colors flex items-center justify-center">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </div>
            `).join('');
        }

        function toggleEditProfile() {
            const form = document.getElementById('edit-profile-form');
            form.classList.toggle('hidden');
        }

        function saveProfile() {
            state.user.name = document.getElementById('edit-name').value;
            state.user.farmName = document.getElementById('edit-farm').value;
            state.user.location = document.getElementById('edit-location').value;
            state.user.phone = document.getElementById('edit-phone').value;

            updateProfileUI();
            toggleEditProfile();
            showToast('Profile updated successfully!');
        }

        // --- Interaction Logic ---
        function handleRequest(elementId, action) {
            const el = document.getElementById(elementId);
            el.style.transform = 'translateX(100%)';
            el.style.opacity = '0';

            setTimeout(() => {
                el.style.display = 'none';
                // Check if empty
                const container = document.getElementById('requests-container');
                // Simple check for demo purposes
                let visible = 0;
                Array.from(container.children).forEach(c => {
                    if (c.style.display !== 'none') visible++;
                });

                if (visible === 0) {
                    container.innerHTML = '<div class="p-8 text-center text-slate-400 text-sm font-medium border-2 border-dashed border-earth-100 rounded-2xl">No active requests at the moment.</div>';
                }
            }, 300);

            showToast(`Request ${action}.`);
        }

        function contactFarmer(itemName) {
            showToast(`Calling owner...`);
        }

        // --- Modal Logic ---
        function openModal() {
            const modal = document.getElementById('listingModal');
            const backdrop = document.getElementById('modalBackdrop');
            const content = document.getElementById('modalContent');

            modal.classList.remove('hidden');
            setTimeout(() => {
                backdrop.classList.remove('opacity-0');
                content.classList.remove('opacity-0', 'translate-y-full');
                if (window.innerWidth >= 768) content.classList.remove('md:translate-y-10');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('listingModal');
            const backdrop = document.getElementById('modalBackdrop');
            const content = document.getElementById('modalContent');

            backdrop.classList.add('opacity-0');
            content.classList.add('opacity-0', 'translate-y-full');
            if (window.innerWidth >= 768) content.classList.add('md:translate-y-10');

            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function submitListing() {
            const name = document.getElementById('itemName').value;
            const price = document.getElementById('itemPrice').value;
            const qty = document.getElementById('itemQty').value;
            const cat = document.getElementById('itemCat').value;

            if (!name || !price || !qty) {
                showToast('Please fill all fields', 'Error');
                return;
            }

            // Add to State
            state.listings.unshift({
                id: Date.now(),
                name: name,
                category: cat,
                price: price,
                qty: qty + ' kg',
                farmer: state.user.name,
                loc: 'Pune, MH', // Default for demo
                time: 'Just now',
                img: 'https://images.unsplash.com/photo-1615484477778-ca3b77940c25?auto=format&fit=crop&q=80&w=600',
                verified: true,
                isMine: true
            });

            // Refresh Views
            renderListings();
            updateProfileUI(); // Update count
            closeModal();

            // Show Success
            showToast('Your produce is live! üöÄ');
            setTimeout(() => switchTab('marketplace'), 500);

            // Reset form
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemQty').value = '';
        }

        function showToast(message, title = 'Success') {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = message;
            document.getElementById('toast-title').innerText = title;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }
    </script>
</body>

</html>