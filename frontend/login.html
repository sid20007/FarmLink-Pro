<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | AgriConnect</title>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        display: ['"Outfit"', 'sans-serif'],
                    },
                    colors: {
                        glass: {
                            100: 'rgba(255, 255, 255, 0.1)',
                            200: 'rgba(255, 255, 255, 0.2)',
                            300: 'rgba(255, 255, 255, 0.3)',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .input-group {
            position: relative;
            transition: all 0.3s ease;
        }

        .input-group input {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            background: rgba(255, 255, 255, 0.9);
            border-color: #10b981;
            /* emerald-500 */
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
        }

        .toggle-btn {
            background: transparent;
            color: #64748b;
        }

        .toggle-btn.active {
            background: #ffffff;
            color: #0f172a;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Toast Animation */
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #0f172a;
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
            font-weight: 500;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }

        .animate-up {
            animation: slideUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center bg-slate-100 relative overflow-hidden font-sans">

    <!-- Background Image -->
    <div class="absolute inset-0 z-0">
        <img src="https://images.unsplash.com/photo-1625246333195-5848c428ad69?q=80&w=2560&auto=format&fit=crop"
            class="w-full h-full object-cover">
        <div class="absolute inset-0 bg-gradient-to-tr from-emerald-900/40 via-slate-900/20 to-transparent"></div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"></div>

    <!-- Main Card -->
    <div class="relative z-10 w-full max-w-[480px] p-6 animate-up">

        <!-- Glass Container -->
        <div class="glass-card rounded-[2.5rem] p-8 md:p-10">

            <!-- Header -->
            <div class="text-center mb-10">
                <div
                    class="inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-emerald-500 text-white mb-6 shadow-lg shadow-emerald-500/30">
                    <i class="fa-solid fa-leaf text-2xl"></i>
                </div>
                <h1 class="text-3xl font-display font-bold text-slate-800 mb-2">AgriConnect</h1>
                <p class="text-slate-500" id="header-subtitle">Welcome back, farmer</p>
            </div>

            <!-- Toggle Switch -->
            <div class="flex p-1.5 bg-slate-100/50 rounded-2xl mb-8 border border-white/50 backdrop-blur-sm">
                <button id="toggle-login" onclick="setMode('login')"
                    class="toggle-btn active flex-1 py-3 rounded-xl text-sm font-bold transition-all">
                    Log In
                </button>
                <button id="toggle-register" onclick="setMode('register')"
                    class="toggle-btn flex-1 py-3 rounded-xl text-sm font-bold transition-all">
                    Sign Up
                </button>
            </div>

            <!-- Form -->
            <form id="authForm" onsubmit="handleSubmit(event)" class="space-y-5">

                <!-- Role Selection (Register Only) -->
                <div id="role-selector" class="hidden grid grid-cols-2 gap-3 mb-2">
                    <label class="cursor-pointer">
                        <input type="radio" name="role" value="farmer" checked class="peer sr-only "
                            onchange="toggleLocationField()">
                        <div
                            class="p-4 rounded-xl border border-transparent bg-white/50 text-slate-500 text-center peer-checked:bg-emerald-50 peer-checked:text-emerald-700 peer-checked:border-emerald-200 transition-all hover:bg-white/80">
                            <i class="fa-solid fa-tractor mb-1"></i><br><span class="text-xs font-bold">Farmer</span>
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="role" value="buyer" class="peer sr-only"
                            onchange="toggleLocationField()">
                        <div
                            class="p-4 rounded-xl border border-transparent bg-white/50 text-slate-500 text-center peer-checked:bg-blue-50 peer-checked:text-blue-700 peer-checked:border-blue-200 transition-all hover:bg-white/80">
                            <i class="fa-solid fa-shop mb-1"></i><br><span class="text-xs font-bold">Buyer</span>
                        </div>
                    </label>
                </div>

                <!-- Name Field -->
                <div id="name-field" class="hidden input-group">
                    <input type="text" id="name" placeholder="Full Name"
                        class="w-full pl-12 pr-4 py-4 rounded-2xl outline-none text-slate-800 placeholder:text-slate-400 font-medium">
                    <i class="fa-regular fa-user absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                </div>

                <!-- Email Field -->
                <div class="input-group">
                    <input type="email" id="email" required placeholder="Email Address"
                        class="w-full pl-12 pr-4 py-4 rounded-2xl outline-none text-slate-800 placeholder:text-slate-400 font-medium">
                    <i class="fa-regular fa-envelope absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                </div>

                <!-- Password Field -->
                <div class="input-group">
                    <input type="password" id="password" required placeholder="Password"
                        class="w-full pl-12 pr-4 py-4 rounded-2xl outline-none text-slate-800 placeholder:text-slate-400 font-medium">
                    <i class="fa-solid fa-lock absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                </div>

                <!-- Location Field -->
                <div id="location-field" class="hidden input-group">
                    <input type="text" id="location" placeholder="City, State"
                        class="w-full pl-12 pr-4 py-4 rounded-2xl outline-none text-slate-800 placeholder:text-slate-400 font-medium">
                    <i class="fa-solid fa-map-pin absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                </div>

                <button type="submit" id="submit-btn"
                    class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-2xl shadow-lg shadow-slate-900/20 transition-all active:scale-[0.98] mt-4">
                    Continue
                </button>
            </form>

            <!-- Footer -->
            <div class="mt-8 pt-6 border-t border-slate-200 text-center">
                <button onclick="showToast('Google Auth coming soon!')"
                    class="text-sm font-semibold text-slate-500 hover:text-slate-800 transition-colors flex items-center justify-center gap-2 mx-auto">
                    <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5">
                    Or sign in with Google
                </button>
            </div>

        </div>

        <!-- Bottom Credits -->
        <p class="text-center text-white/60 text-xs mt-6 font-medium">
            &copy; 2024 AgriConnect Inc.
        </p>

    </div>

    <script>
        let isLogin = true;
        const apiBase = '/api/auth';

        function setMode(mode) {
            isLogin = mode === 'login';
            const title = document.getElementById('header-subtitle');
            const submitBtn = document.getElementById('submit-btn');

            // Buttons
            document.getElementById('toggle-login').classList.toggle('active', isLogin);
            document.getElementById('toggle-register').classList.toggle('active', !isLogin);

            // Visibility
            const fields = ['role-selector', 'name-field'];
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (isLogin) el.classList.add('hidden');
                else el.classList.remove('hidden');
            });

            // Special logic for location
            toggleLocationField();

            // Text
            if (isLogin) {
                title.innerText = 'Welcome back, farmer';
                submitBtn.innerText = 'Log In';
            } else {
                title.innerText = 'Join the network';
                submitBtn.innerText = 'Create Account';
            }
        }

        function toggleLocationField() {
            if (isLogin) {
                document.getElementById('location-field').classList.add('hidden');
                return;
            }
            const role = document.querySelector('input[name="role"]:checked').value;
            // Show location only if Farmer is selected
            if (role === 'farmer') {
                document.getElementById('location-field').classList.remove('hidden');
            } else {
                document.getElementById('location-field').classList.add('hidden');
            }
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.style.backgroundColor = isError ? '#ef4444' : '#0f172a';
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        async function handleSubmit(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.7';

            try {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (isLogin) {
                    const res = await fetch(`${apiBase}/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.msg || 'Login failed');

                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    showToast('Welcome back! Redirecting...');
                    setTimeout(() => window.location.href = 'index.html', 1000);
                } else {
                    const name = document.getElementById('name').value;
                    const role = document.querySelector('input[name="role"]:checked').value;
                    const location = document.getElementById('location').value;

                    if (role === 'farmer' && !location) throw new Error('Location required for farmers');

                    const res = await fetch(`${apiBase}/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, password, role, location })
                    });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.msg || 'Registration failed');

                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    showToast('Account created! ðŸš€');
                    setTimeout(() => window.location.href = 'index.html', 1000);
                }
            } catch (err) {
                showToast(err.message, true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
            }
        }

        // Init
        toggleLocationField();
    </script>
</body>

</html>